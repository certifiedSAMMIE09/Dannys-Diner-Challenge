select * from assessment.menu_table
select * from assessment.members_table
select * from assessment.sales_table


-- 1. What is the total amount each customer spent at the restaurant?
select product_id, sum(price)
from assessment.menu_table
Join assessment.sales_table
using(product_id)
group by product_id

-- 2. How many days has each customer visited the restaurant?
select customer_id, count(distinct order_date)
from assessment.sales_table
Group by customer_id

-- 3. What was the first item from the menu purchased by each customer?
with cte as
(
select product_name, customer_id, order_date,
dense_rank() over (partition by customer_id order by order_date) first_purchased_item
from assessment.sales_table
join assessment.menu_table
using(product_id)
group by product_name, customer_id, order_date
)
select product_name, customer_id
from cte
where first_purchased_item=1

-- 4. What is the most purchased item on the menu and how many times was it purchased by all customers?
select product_name, count(product_id)
from assessment.sales_table
join assessment.menu_table
using(product_id)
Group by product_name
Order by count(product_id) desc
Limit 1




 
-- 5. Which item was the most popular for each customer?
with cte as 
(
select customer_id, product_name, count(product_id)cnt,
dense_rank() over (partition by customer_id order by count(product_id) desc) most_popular
from assessment.sales_table
join assessment.menu_table
using(product_id)
group by customer_id, product_id, product_name
)
select customer_id, product_name, cnt
from cte
where most_popular=1


-- 6. Which item was purchased first by the customer after they became a member?
with cte as
(
select customer_id, product_name, order_date,
dense_rank() over(partition by customer_id order by order_date) first_purchased
from assessment.members_table
join assessment.sales_table
using(customer_id)
join assessment.menu_table
using(product_id)
where order_date>join_date
)
select customer_id, product_name
from cte
where first_purchased = 1


-- 7. Which item was purchased just before the customer became a member?
With CTE as
(
select customer_id, product_name, order_date,
dense_rank() over (partition by customer_id order by order_date desc)item_rank
from assessment.members_table
Join assessment.sales_table
using(customer_id)
Join assessment.menu_table
using(product_id)
where order_date<join_date
)
select customer_id, product_name
from cte
where item_rank=1

-- 8. What is the total items and amount spent for each member before they became a member?
select st.customer_id, count(distinct mt.product_id), sum(mt.price)
from assessment.sales_table st
Join assessment.menu_table mt
on st.product_id=mt.product_id
Join assessment.members_table amt
on st.customer_id=amt.customer_id
where st.order_date<amt.join_date
Group by st.customer_id


-- 9.  If each $1 spent equates to 10 points and salad has a 2x points multiplier 
-- - how many points would each customer have?
select customer_id,
sum(case when product_id=1 then price*20 else price*10 end)total_points
from assessment.sales_table
Join assessment.menu_table
Using(product_id)
Group by customer_id
Order by customer_id

-- 10. In the first week after a customer joins the program (including their join date) 
-- they earn 2x points on all items, not just salad
-- - how many points do customer A and B have at the end of January?
select * from assessment.members_table
select * from assessment.menu_table
select customer_id,
sum(case when order_date between join_date and join_date + interval'7day' then price*20 end)
from assessment.members_table
join assessment.sales_table
using(customer_id)
join assessment.menu_table
using(product_id)
group by customer_id




\copy sales from 'C:\Users\user\Downloads\1000 Sales Records.csv' delimiter ',' csv header